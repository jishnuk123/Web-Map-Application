<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>COVID-19 Rates in the United States (2020)</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">

    <!-- Mapbox GL JS -->
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.8.1/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.8.1/mapbox-gl.js"></script>

    <!-- Google Font (same as lab) -->
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">

    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Open Sans', sans-serif;
        }

        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }

        /* Legend */
        #legend {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 160px;
            background: #fff;
            margin-right: 20px;
            margin-bottom: 40px;
            padding: 10px;
            border-radius: 3px;
            font-size: 12px;
        }

        .legend-key {
            display: inline-block;
            width: 20px;
            height: 12px;
            margin-right: 8px;
        }

        #title {
            position: absolute;
            top: 0;
            left: 0;
            margin-top: 20px;
            margin-left: 20px;
            font-size: 24pt;
            color: white;
        }

        #subtitle {
            position: absolute;
            top: 0;
            left: 0;
            margin-top: 65px;
            margin-left: 20px;
            font-size: 14pt;
            color: white;
        }
    </style>
</head>

<body>

    <div id="map"></div>

    <div id="title">COVID-19 Case Rates</div>
    <div id="subtitle">United States, 2020</div>

    <div id="legend">
        <strong>Cases per 1,000</strong><br><br>
        <div><span class="legend-key" style="background:#FED976"></span>0–15</div>
        <div><span class="legend-key" style="background:#FD8D3C"></span>15–30</div>
        <div><span class="legend-key" style="background:#FC4E2A"></span>30–45</div>
        <div><span class="legend-key" style="background:#E31A1C"></span>45–60</div>
        <div><span class="legend-key" style="background:#800026"></span>60+</div>
        <p style="font-size:10px; text-align:right;">
            Source: NYT & ACS
        </p>
    </div>

    <script>
        mapboxgl.accessToken =
            'pk.eyJ1IjoiamthbmRhIiwiYSI6ImNtaGN5c3JwbDIyNDUybHBxM2VweHBrNzYifQ.Akume5yUr5MZyYxPQq9EjA';

        let map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/dark-v10',
            center: [-96, 37.8],
            zoom: 4,
            minZoom: 3,
            projection: 'albers'
        });

        const grades = [15, 30, 45, 60];
        const colors = [
            '#FED976',
            '#FD8D3C',
            '#FC4E2A',
            '#E31A1C',
            '#800026'
        ];

        map.on('load', () => {

            map.addSource('covidRates', {
                type: 'geojson',
                data: 'assets/us-covid-2020-rates.json'
            });

            map.addLayer({
                id: 'covid-rates-layer',
                type: 'fill',
                source: 'covidRates',
                paint: {
                    'fill-color': [
                        'step',
                        ['get', 'rates'],
                        colors[0],
                        grades[0], colors[1],
                        grades[1], colors[2],
                        grades[2], colors[3],
                        grades[3], colors[4]
                    ],
                    'fill-opacity': 0.7,
                    'fill-outline-color': 'white'
                }
            });

            map.on('click', 'covid-rates-layer', (e) => {
                const p = e.features[0].properties;
                new mapboxgl.Popup()
                    .setLngLat(e.lngLat)
                    .setHTML(
                        `<strong>${p.county}, ${p.state}</strong><br>
                         Case rate: ${p.rates} per 1,000`
                    )
                    .addTo(map);
            });

        });
    </script>

</body>

</html>
